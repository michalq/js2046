var G2048=function(a){var b=this;this.fields=[],this.console=!1,this.width=4,this.height=4,this.fieldsAmount=16,this.view=new G2048.View(a,b),b.points=0,this.getEmptyFields=function(){var a=[];for(i=0;i<b.fieldsAmount;i++)0==b.fields[i]&&a.push(i);return a},this.newValue=function(){var a=b.getEmptyFields(),c=Math.floor(Math.random()*a.length),d=2*(Math.round(Math.random())+1);b.updateField(a[c],d),1==b.console&&(console.info("Putting new random value.",a),console.info("Random key:",c,"Random empty key:",a[c],"Random value",d))},this.move=function(a){var e=null,f=null,g=0,h=0,i={},j=b.width*b.height,k=!1;addition=!1;for(var l=0;j>l;l++)if(i=c(a,l),g=i.i,h=i.end,f=d(a,g),0!=h)if(0!=b.fields[g])if(null==e)b.fields[g]!=b.fields[f]||(b.points+=2*b.fields[g],b.updateField(f,2*b.fields[g]),b.updateField(g,0),k=!0,addition=!0,e=g);else{if(0==addition&&b.fields[g]==b.fields[d(a,e)]){b.points+=2*b.fields[g],b.updateField(d(a,e),2*b.fields[g]),b.updateField(g,0),l=c(a,e).i,k=!0,addition=!0,e=null;continue}b.updateField(e,b.fields[g]),b.updateField(g,0),l=c(a,e).i,k=!0,addition=!1,e=null}else null==e&&(e=g);else e=0==b.fields[g]?g:null,addition=!1;1==k&&b.newValue()};var c=function(a,c){var d;switch(a){case 0:d=c,end=d%b.width;break;case 1:d=c%b.height*b.width+Math.floor(c/b.height),end=1,d<b.width&&d>=0&&(end=0);break;case 2:d=b.fieldsAmount-1-c,end=(d+1)%b.width;break;case 3:d=Math.abs(c%b.height*b.width+Math.floor(c/b.height)-(b.fieldsAmount-1)),end=1,d<b.height*b.width&&d>=b.width*(b.height-1)&&(end=0)}return{i:d,end:end}},d=function(a,c){return 0==a?c-1:1==a?c-b.width:2==a?c+1:3==a?c+b.width:void 0};this.updateField=function(a,c){b.fields[a]=c,b.view.updateField(a,c)},this.init=function(){b.fieldsAmount=b.width*b.height,this.view.init();for(var a=0;a<b.fieldsAmount;a++)b.fields.push(0);for(var a=0;a<b.fieldsAmount;a++)b.updateField(a,b.fields[a]);b.newValue(),b.newValue()}};G2048.View=function(a,b){var c=this;"undefined"==typeof a&&(a="g2048"),this.$fields=[],this.lineClass="line",this.fieldClass="field",this.g2048Selector="",this.lineSelector="",this.fieldSelector="",this.updateField=function(a,d){htmlValue=0==d||isNaN(d)?"&nbsp;":d,$(".gameDetails .points").html(b.points),$(c.$fields[a]).html(htmlValue),$(c.$fields[a]).removeClass("p0"),$(c.$fields[a]).removeClass("p2"),$(c.$fields[a]).removeClass("p4"),$(c.$fields[a]).removeClass("p8"),$(c.$fields[a]).removeClass("p16"),$(c.$fields[a]).removeClass("p32"),$(c.$fields[a]).removeClass("p64"),$(c.$fields[a]).removeClass("p128"),$(c.$fields[a]).removeClass("p256"),$(c.$fields[a]).removeClass("p512"),$(c.$fields[a]).removeClass("p1024"),$(c.$fields[a]).removeClass("p2048"),$(c.$fields[a]).addClass("p"+d)};var d=function(){for(var a=$(c.g2048Selector),d=0;d<b.height;d++)a.append('<div class="'+c.lineClass+'"></div>');for(var e=$(c.lineSelector),d=0;d<b.width;d++)e.append('<div class="'+c.fieldClass+'"></div>');c.$fields=$(c.fieldSelector)};this.init=function(){c.g2048Selector="."+a,c.lineSelector=c.g2048Selector+" ."+c.lineClass,c.fieldSelector=c.g2048Selector+" ."+c.fieldClass,d()}};